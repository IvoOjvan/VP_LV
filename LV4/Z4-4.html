<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Z4-4</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script src="http://code.jquery.com/jquery.min.js"></script>
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <style>
            .node circle {
                fill: #fff;
                stroke: steelblue;
                stroke-width: 1.5px;
            } 
            
            .node {
                font: 10px sans-serif;
            }

            .link {
                fill: none;
                stroke: #ccc;
                stroke-width: 1.5px;
            }
        </style>
    </head>
    <body>
        <script>
            var data = {
                "name": "flare",
                "children": [
                {
                    "name": "analytics",
                    "children": [
                    {
                        "name": "cluster",
                        "children": [
                            {"name": "AgglomerativeCluster", "size": 3938},
                            {"name": "CommunityStructure", "size": 3812},
                            {"name": "MergeEdge", "size": 743}
                            ]
                    },
                    { "name": "graph",
                        "children": [
                            {"name": "BetweennessCentrality", "size": 3534},
                            {"name": "LinkDistance", "size": 5731}
                        ]
                    }
                    ]
                }
            ]};

            var width = 500;
            var height = 500;

            var cluster = d3.layout.cluster()
                .size([height, width - 160]);
            
            var diagonal = d3.svg.diagonal()
                .projection(function(d) { return [d.y, d.x]; });

            var svg = d3.select("body").append("svg")
                .attr("width", width)
                .attr("height", height)
                .append("g")
                .attr("transform", "translate(40,0)");

            var nodes = cluster.nodes(data),
                links = cluster.links(nodes);

            console.log(links)
            
            var link = svg.selectAll(".link")
                .data(links)
                .enter().append("path")
                .attr("class", "link")
                .attr("id", function(d){ return d.target.name + "link" })
                .attr("opacity", 1)
                .attr("d", diagonal);

            var node = svg.selectAll(".node")
                .data(nodes)
                .enter().append("g")
                .attr("class", "node")
                .attr("id", function(d){ return d.name; })
                .attr("opacity", 1)
                .attr("transform", function(d) { return "translate(" + d.y + "," + d.x + ")"; })
                .on("click", click)
            
            node.append("circle") 
                .attr("r", 4.5);

            node.append("text")
                .attr("dx", function(d) { return d.children ? -8 : 8; })
                .attr("dy", 3)
                .style("text-anchor", function(d) { return d.children ? "end" : "start"; })
                .text(function(d) { return d.name; });
/*
            function click(d){
                d.children.forEach(element => {
                    d3.select("#"+element.name)
                    .attr("opacity", function(){
                        opacity = d3.select(this).attr("opacity");
                        if(opacity == 1)
                            return 0;
                        else{
                            return 1;
                        }
                        })
                    d3.select("#"+element.name+"link")
                        .attr("opacity", function(){
                            opacity = d3.select(this).attr("opacity");
                            if(opacity == 1)
                                return 0;
                            else{
                                return 1;
                            }
                        })
                });

            }    */

            function click(d){
            if(d.children) {
                d.children.forEach(child => {
                    var childNode = d3.select("#"+child.name);
                    var childLink = d3.select("#"+child.name+"link");
                    var opacity = childNode.attr("opacity") == 1 ? 0 : 1;
                    childNode.attr("opacity", opacity);
                    childLink.attr("opacity", opacity);
                });
            }
        }
        </script>
    </body>
</html>